{% extends "base.html" %}
{% block title %}Connexion{% endblock %}
{% block content %}
<style>
  .login-shell {
    display:flex;
    align-items:center;
    justify-content:center;
    min-height: calc(100vh - 160px);
  }
  .login-card {
    width: 100%;
    max-width: 420px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 22px;
    box-shadow: var(--shadow);
  }
  .login-header { margin-bottom: 14px; }
  .login-header h1 { margin: 0 0 6px; font-size: 1.6rem; }
  .login-header p { margin: 0; color: var(--muted); font-size: 0.95rem; }
  .badge {
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    background: rgba(15,139,141,0.08);
    font-size:0.8rem;
    color: var(--text);
    margin-bottom:10px;
  }
  form { display:flex; flex-direction:column; gap:12px; }
  .field { display:flex; flex-direction:column; gap:6px; }
  label { font-size:0.9rem; color: var(--muted); }
  input[type="text"], input[type="password"] {
    width:100%;
    padding:11px 14px;
    border-radius:14px;
    border:1px solid rgba(15,139,141,0.25);
    background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.75));
    color: var(--text);
    box-shadow: inset 0 1px 2px rgba(15,139,141,0.08), 0 6px 14px rgba(15,139,141,0.08);
    transition: border .2s ease, box-shadow .2s ease, transform .2s ease;
  }
  .password-field { position: relative; }
  .password-field input { padding-right: 46px; }
  .toggle-pass {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    border: 1px solid rgba(15,139,141,0.25);
    background: rgba(15,139,141,0.12);
    color: var(--text);
    border-radius: 10px;
    padding: 6px 8px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .toggle-pass svg { width: 18px; height: 18px; }
  input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(15,139,141,0.2), 0 12px 24px rgba(15,139,141,0.18);
    transform: translateY(-1px);
  }
  .btn {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    padding:12px 16px;
    border-radius:14px;
    font-weight:700;
    border:1px solid rgba(15,139,141,0.35);
    cursor:pointer;
    background: linear-gradient(135deg, var(--accent), #18b0ac);
    color:#fff;
    box-shadow: 0 12px 24px rgba(15,139,141,0.2);
    transition: transform .2s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
  }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 14px 26px rgba(15,139,141,0.22); }
  .btn:active { transform: translateY(0); box-shadow: 0 8px 18px rgba(15,139,141,0.18); }
  .alert {
    padding:10px 12px;
    border-radius:12px;
    border:1px solid rgba(239,68,68,0.3);
    background: rgba(239,68,68,0.08);
    color:#b91c1c;
    font-size:0.9rem;
  }
  .field-error { font-size:0.8rem; color:#b91c1c; }
  .hint { font-size:0.85rem; color: var(--muted); margin-top: 10px; }
  @media (max-width: 640px) {
    .login-shell { min-height: auto; padding: 10px 0; }
  }
</style>

<div class="login-shell">
  <div class="login-card">
    <div class="login-header">
      <div class="badge">PADESCE</div>
      <h1>Connexion</h1>
      <p>Acces reserve aux utilisateurs autorises.</p>
    </div>

    {% if form.non_field_errors %}
      <div class="alert">{{ form.non_field_errors }}</div>
    {% endif %}

    <form method="post">
      {% csrf_token %}
      {% if next %}
        <input type="hidden" name="next" value="{{ next }}">
      {% endif %}
      <div class="field">
        <label for="{{ form.username.id_for_label }}">Nom d'utilisateur</label>
        {{ form.username }}
        {% for err in form.username.errors %}<div class="field-error">{{ err }}</div>{% endfor %}
      </div>
      <div class="field">
        <label for="{{ form.password.id_for_label }}">Mot de passe</label>
        <div class="password-field">
          {{ form.password }}
          <button class="toggle-pass" type="button" data-target="{{ form.password.id_for_label }}" aria-label="Afficher le mot de passe" aria-pressed="false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M2 12s4-6 10-6 10 6 10 6-4 6-10 6-10-6-10-6z"></path>
              <circle cx="12" cy="12" r="3.2"></circle>
            </svg>
          </button>
        </div>
        {% for err in form.password.errors %}<div class="field-error">{{ err }}</div>{% endfor %}
      </div>
      <button class="btn" type="submit">Se connecter</button>
    </form>

    <div class="hint">Le super utilisateur cree les comptes pour chaque role.</div>
  </div>
</div>
<script>
  (function() {
    document.querySelectorAll(".toggle-pass").forEach((btn) => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-target");
        const input = document.getElementById(target);
        if (!input) return;
        const isText = input.type === "text";
        input.type = isText ? "password" : "text";
        btn.setAttribute("aria-pressed", (!isText).toString());
      });
    });
  })();
</script>
{% endblock %}
